<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.36">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Luis P Iniguez">

<title>SingleCell RNA-seq Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">SingleCell RNA-seq Workshop</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./sc_scripts.html" aria-current="page">General Scripts</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./sc_integrating.html">Integration Scripts</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./sc_metacell.html">Metacell Scripts</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#load-packages" id="toc-load-packages" class="nav-link active" data-scroll-target="#load-packages">Load Packages</a></li>
  <li><a href="#download-data-and-read-it." id="toc-download-data-and-read-it." class="nav-link" data-scroll-target="#download-data-and-read-it.">Download Data and read it.</a>
  <ul class="collapse">
  <li><a href="#explore-datasets" id="toc-explore-datasets" class="nav-link" data-scroll-target="#explore-datasets">Explore datasets</a></li>
  </ul></li>
  <li><a href="#quality-control" id="toc-quality-control" class="nav-link" data-scroll-target="#quality-control">Quality Control</a>
  <ul class="collapse">
  <li><a href="#identify-thresholds" id="toc-identify-thresholds" class="nav-link" data-scroll-target="#identify-thresholds">Identify thresholds</a></li>
  </ul></li>
  <li><a href="#normalization" id="toc-normalization" class="nav-link" data-scroll-target="#normalization">Normalization</a></li>
  <li><a href="#feature-selection" id="toc-feature-selection" class="nav-link" data-scroll-target="#feature-selection">Feature Selection</a></li>
  <li><a href="#dimension-reduction" id="toc-dimension-reduction" class="nav-link" data-scroll-target="#dimension-reduction">Dimension Reduction</a>
  <ul class="collapse">
  <li><a href="#pca" id="toc-pca" class="nav-link" data-scroll-target="#pca">PCA</a></li>
  <li><a href="#tsne" id="toc-tsne" class="nav-link" data-scroll-target="#tsne">TSNE</a></li>
  <li><a href="#umap" id="toc-umap" class="nav-link" data-scroll-target="#umap">UMAP</a></li>
  </ul></li>
  <li><a href="#clustering" id="toc-clustering" class="nav-link" data-scroll-target="#clustering">Clustering</a></li>
  <li><a href="#markers-seurat-object" id="toc-markers-seurat-object" class="nav-link" data-scroll-target="#markers-seurat-object">Markers (Seurat Object)</a></li>
  <li><a href="#visualizations" id="toc-visualizations" class="nav-link" data-scroll-target="#visualizations">Visualizations</a></li>
  <li><a href="#cluster-annotation" id="toc-cluster-annotation" class="nav-link" data-scroll-target="#cluster-annotation">Cluster Annotation</a></li>
  <li><a href="#isee" id="toc-isee" class="nav-link" data-scroll-target="#isee">iSEE</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">SingleCell RNA-seq Workshop</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Luis P Iniguez </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="load-packages" class="level2">
<h2 class="anchored" data-anchor-id="load-packages">Load Packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"BiocManager"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">install.packages</span>(<span class="st">"BiocManager"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"pacman"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>))</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    BiocManager<span class="sc">::</span><span class="fu">install</span>(<span class="st">"pacman"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"SingleCellExperiment"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"Seurat"</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"hdf5r"</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"DropletUtils"</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"scater"</span>)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"Matrix"</span>)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"scran"</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"igraph"</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"SingleR"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"celldex"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">#p_load("iSEE")</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"Nebulosa"</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"UpSetR"</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"clustree"</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"Rmagic"</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"SeuratWrappers"</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"CelliD"</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"pheatmap"</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"pals"</span>)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="fu">p_load</span>(<span class="st">"readr"</span>)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(<span class="st">"devtools"</span>))</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"devtools"</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"findPC"</span>))</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"haotian-zhuang/findPC"</span>)</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"SeuratWrappers"</span>))</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">'satijalab/seurat-wrappers'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="download-data-and-read-it." class="level2">
<h2 class="anchored" data-anchor-id="download-data-and-read-it.">Download Data and read it.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">system</span>(<span class="st">"wget -q https://cf.10xgenomics.com/samples/cell-exp/6.1.0/10k_PBMC_3p_nextgem_Chromium_X/10k_PBMC_3p_nextgem_Chromium_X_filtered_feature_bc_matrix.h5"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>sce_data<span class="ot">&lt;-</span> DropletUtils<span class="sc">::</span><span class="fu">read10xCounts</span>(<span class="st">"10k_PBMC_3p_nextgem_Chromium_X_filtered_feature_bc_matrix.h5"</span>,<span class="at">sample.names =</span> <span class="st">"pbmc"</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>mat<span class="ot">&lt;-</span>Seurat<span class="sc">::</span><span class="fu">Read10X_h5</span>(<span class="st">"10k_PBMC_3p_nextgem_Chromium_X_filtered_feature_bc_matrix.h5"</span>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>seurat_data <span class="ot">&lt;-</span> <span class="fu">CreateSeuratObject</span>(<span class="at">counts =</span> mat, <span class="at">project =</span> <span class="st">"pbmc"</span>, <span class="at">min.cells =</span> <span class="dv">0</span>, <span class="at">min.features =</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="explore-datasets" class="level3">
<h3 class="anchored" data-anchor-id="explore-datasets">Explore datasets</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sce_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class: SingleCellExperiment 
dim: 36601 11996 
metadata(1): Samples
assays(1): counts
rownames(36601): ENSG00000243485 ENSG00000237613 ... ENSG00000278817
  ENSG00000277196
rowData names(3): ID Symbol Type
colnames: NULL
colData names(2): Sample Barcode
reducedDimNames(0):
mainExpName: NULL
altExpNames(0):</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>seurat_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An object of class Seurat 
36601 features across 11996 samples within 1 assay 
Active assay: RNA (36601 features, 0 variable features)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colData</span>(sce_data) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DataFrame with 6 rows and 2 columns
       Sample            Barcode
  &lt;character&gt;        &lt;character&gt;
1        pbmc AAACCCAAGGCCCAAA-1
2        pbmc AAACCCAAGTAATACG-1
3        pbmc AAACCCAAGTCACACT-1
4        pbmc AAACCCACAAAGCGTG-1
5        pbmc AAACCCACAATCGAAA-1
6        pbmc AAACCCACAGATCACT-1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sce_data) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ENSG00000243485" "ENSG00000237613" "ENSG00000186092" "ENSG00000238009"
[5] "ENSG00000239945" "ENSG00000239906"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rowData</span>(sce_data) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DataFrame with 6 rows and 3 columns
                             ID      Symbol            Type
                    &lt;character&gt; &lt;character&gt;     &lt;character&gt;
ENSG00000243485 ENSG00000243485 MIR1302-2HG Gene Expression
ENSG00000237613 ENSG00000237613     FAM138A Gene Expression
ENSG00000186092 ENSG00000186092       OR4F5 Gene Expression
ENSG00000238009 ENSG00000238009  AL627309.1 Gene Expression
ENSG00000239945 ENSG00000239945  AL627309.3 Gene Expression
ENSG00000239906 ENSG00000239906  AL627309.2 Gene Expression</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(seurat_data) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "MIR1302-2HG" "FAM138A"     "OR4F5"       "AL627309.1"  "AL627309.3" 
[6] "AL627309.2" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">rownames</span>(seurat_data), <span class="fu">rowData</span>(sce_data)<span class="sc">$</span>Symbol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">setdiff</span>(<span class="fu">rownames</span>(seurat_data),<span class="fu">rowData</span>(sce_data)<span class="sc">$</span>Symbol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "TBCE.1"           "LINC01238.1"      "CYB561D2.1"       "MATR3.1"         
 [5] "LINC01505.1"      "HSPA14.1"         "GOLGA8M.1"        "GGT1.1"          
 [9] "ARMCX5-GPRASP2.1" "TMSB15B.1"       </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grep</span>(<span class="st">"LINC01238"</span>, <span class="fu">rownames</span>(seurat_data),<span class="at">value=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "LINC01238"   "LINC01238.1"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rowData</span>(sce_data)[<span class="fu">which</span>(<span class="fu">rowData</span>(sce_data)<span class="sc">$</span>Symbol <span class="sc">==</span> <span class="st">"LINC01238"</span>),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DataFrame with 2 rows and 3 columns
                             ID      Symbol            Type
                    &lt;character&gt; &lt;character&gt;     &lt;character&gt;
ENSG00000237940 ENSG00000237940   LINC01238 Gene Expression
ENSG00000261186 ENSG00000261186   LINC01238 Gene Expression</code></pre>
</div>
</div>
</section>
</section>
<section id="quality-control" class="level2">
<h2 class="anchored" data-anchor-id="quality-control">Quality Control</h2>
<section id="seurat" class="level4">
<h4 class="anchored" data-anchor-id="seurat">Seurat</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>seurat_data[[<span class="st">"Mitochondrial"</span>]] <span class="ot">&lt;-</span> <span class="fu">PercentageFeatureSet</span>(seurat_data, <span class="at">pattern =</span> <span class="st">"^MT-"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">VlnPlot</span>(seurat_data, <span class="at">features =</span> <span class="fu">c</span>( <span class="st">"nCount_RNA"</span>,<span class="st">"nFeature_RNA"</span>, <span class="st">"Mitochondrial"</span>), <span class="at">ncol =</span> <span class="dv">3</span>,<span class="at">pt.size =</span> <span class="fl">0.01</span>,<span class="at">log =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="bioconductor" class="level4">
<h4 class="anchored" data-anchor-id="bioconductor">Bioconductor</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>is.mito <span class="ot">&lt;-</span><span class="fu">grepl</span>(<span class="st">"^MT-"</span>, <span class="fu">rowData</span>(sce_data)<span class="sc">$</span>Symbol, <span class="at">perl =</span> T) <span class="sc">%&gt;%</span> which</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>sce_data<span class="ot">&lt;-</span>scater<span class="sc">::</span><span class="fu">addPerCellQC</span>(sce_data,<span class="at">subsets=</span><span class="fu">list</span>(<span class="st">"Mitochondrial"</span><span class="ot">=</span>is.mito))</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plotColData</span>(sce_data, <span class="at">y=</span><span class="st">"sum"</span>,) <span class="sc">+</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_y_log10</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Total count"</span>),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plotColData</span>(sce_data, <span class="at">y=</span><span class="st">"detected"</span>) <span class="sc">+</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_y_log10</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Detected features"</span>),</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plotColData</span>(sce_data, <span class="at">y=</span><span class="st">"subsets_Mitochondrial_percent"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Mito percent"</span>)<span class="sc">+</span><span class="fu">scale_y_log10</span>(),</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol=</span><span class="dv">3</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="identify-thresholds" class="level3">
<h3 class="anchored" data-anchor-id="identify-thresholds">Identify thresholds</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>qc.lib2 <span class="ot">&lt;-</span> scater<span class="sc">::</span><span class="fu">isOutlier</span>(seurat_data<span class="sc">$</span>nCount_RNA, <span class="at">log=</span><span class="cn">TRUE</span>, <span class="at">type=</span><span class="st">"lower"</span>,<span class="at">nmads=</span><span class="dv">3</span>) <span class="co">#sce_data$sum</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>qc.nexprs2 <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(seurat_data<span class="sc">$</span>nFeature_RNA, <span class="at">log=</span><span class="cn">TRUE</span>,<span class="at">nmads=</span><span class="dv">3</span>, <span class="at">type=</span><span class="st">"lower"</span>) <span class="co">#sce_data$detected</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>qc.mito2 <span class="ot">&lt;-</span> <span class="fu">isOutlier</span>(seurat_data<span class="sc">$</span>Mitochondrial ,<span class="at">nmads=</span><span class="dv">3</span>,<span class="at">type=</span><span class="st">"higher"</span>) <span class="co">#sce_data$subsets_Mitochondrial_percent</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>discard2 <span class="ot">&lt;-</span> qc.lib2 <span class="sc">|</span> qc.nexprs2  <span class="sc">|</span> qc.mito2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="st">"Total count"</span><span class="ot">=</span><span class="fu">attr</span>(qc.lib2, <span class="st">"thresholds"</span>),</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="st">"Detected features"</span><span class="ot">=</span><span class="fu">attr</span>(qc.nexprs2, <span class="st">"thresholds"</span>),</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="st">"Mito percent"</span><span class="ot">=</span><span class="fu">attr</span>(qc.mito2, <span class="st">"thresholds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Total.count Detected.features Mito.percent
lower     1679.027          591.9659         -Inf
higher         Inf               Inf     13.47941</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="st">"Total count"</span><span class="ot">=</span><span class="fu">sum</span>(qc.lib2), <span class="st">"Detected features"</span><span class="ot">=</span><span class="fu">sum</span>(qc.nexprs2),</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Mito percent"</span><span class="ot">=</span><span class="fu">sum</span>(qc.mito2),<span class="st">"Total"</span><span class="ot">=</span><span class="fu">sum</span>(discard2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Total.count Detected.features Mito.percent Total
1         307               245          525   571</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>sce_data<span class="sc">$</span>discard<span class="ot">&lt;-</span>discard2</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>seurat_data<span class="sc">$</span>discard<span class="ot">&lt;-</span>discard2</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plotColData</span>(sce_data, <span class="at">y=</span><span class="st">"sum"</span>,<span class="at">colour_by=</span><span class="st">"discard"</span>) <span class="sc">+</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_y_log10</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Total count"</span>),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plotColData</span>(sce_data, <span class="at">y=</span><span class="st">"detected"</span>,<span class="at">colour_by=</span><span class="st">"discard"</span>) <span class="sc">+</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">scale_y_log10</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Detected features"</span>),</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plotColData</span>(sce_data, <span class="at">y=</span><span class="st">"subsets_Mitochondrial_percent"</span>,<span class="at">colour_by=</span><span class="st">"discard"</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">"Mito percent"</span>)<span class="sc">+</span><span class="fu">scale_y_log10</span>(),</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol=</span><span class="dv">3</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>seurat_data<span class="ot">&lt;-</span><span class="fu">subset</span>(seurat_data,<span class="at">subset=</span> discard<span class="sc">!=</span><span class="cn">TRUE</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>sce_data<span class="ot">&lt;-</span>sce_data[,<span class="sc">!</span>sce_data<span class="sc">$</span>discard]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="normalization" class="level2">
<h2 class="anchored" data-anchor-id="normalization">Normalization</h2>
<section id="seurat-1" class="level4">
<h4 class="anchored" data-anchor-id="seurat-1">Seurat</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>seurat_data <span class="ot">&lt;-</span> <span class="fu">NormalizeData</span>(seurat_data, <span class="at">normalization.method =</span> <span class="st">"LogNormalize"</span>, <span class="at">scale.factor =</span> <span class="dv">10000</span>, <span class="at">verbose=</span>F)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>seurat_data <span class="ot">&lt;-</span> <span class="fu">SCTransform</span>(seurat_data, <span class="at">verbose=</span>F) <span class="co">#could regress for multiple factors, including batch</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Assays</span>(seurat_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "RNA" "SCT"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DefaultAssay</span>(seurat_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "SCT"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">GetAssayData</span>(seurat_data,<span class="at">slot =</span> <span class="st">"counts"</span>)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AAACCCAAGGCCCAAA-1 AAACCCAAGTAATACG-1 AAACCCAAGTCACACT-1 AAACCCACAAAGCGTG-1 
              8022               7459               7798               6492 
AAACCCACAATCGAAA-1 
              7242 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">GetAssayData</span>(seurat_data,<span class="at">slot =</span> <span class="st">"data"</span>)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AAACCCAAGGCCCAAA-1 AAACCCAAGTAATACG-1 AAACCCAAGTCACACT-1 AAACCCACAAAGCGTG-1 
          2726.429           2719.696           2846.029           1609.266 
AAACCCACAATCGAAA-1 
          2070.074 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">GetAssayData</span>(seurat_data,<span class="at">assay =</span> <span class="st">"RNA"</span>,<span class="at">slot =</span> <span class="st">"counts"</span>)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AAACCCAAGGCCCAAA-1 AAACCCAAGTAATACG-1 AAACCCAAGTCACACT-1 AAACCCACAAAGCGTG-1 
             12143               7811               9741               5561 
AAACCCACAATCGAAA-1 
              7399 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">GetAssayData</span>(seurat_data,<span class="at">assay =</span> <span class="st">"RNA"</span>,<span class="at">slot =</span> <span class="st">"data"</span>)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AAACCCAAGGCCCAAA-1 AAACCCAAGTAATACG-1 AAACCCAAGTCACACT-1 AAACCCACAAAGCGTG-1 
          3026.689           3154.815           3159.359           2112.424 
AAACCCACAATCGAAA-1 
          2459.633 </code></pre>
</div>
</div>
</section>
<section id="bioconductor-1" class="level4">
<h4 class="anchored" data-anchor-id="bioconductor-1">Bioconductor</h4>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Warning:
</div>
</div>
<div class="callout-body-container callout-body">
<p>Might take a little bit!</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1000</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>clusters <span class="ot">&lt;-</span> scran<span class="sc">::</span><span class="fu">quickCluster</span>(sce_data)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>sce_data <span class="ot">&lt;-</span> scran<span class="sc">::</span><span class="fu">computeSumFactors</span>(sce_data, <span class="at">cluster=</span>clusters)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>sce_data <span class="ot">&lt;-</span> scater<span class="sc">::</span><span class="fu">logNormCounts</span>(sce_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">assayNames</span>(sce_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "counts"    "logcounts"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(<span class="fu">logcounts</span>(sce_data)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3961.312 3783.641 3897.069 3186.119 3533.383</code></pre>
</div>
</div>
</section>
</section>
<section id="feature-selection" class="level2">
<h2 class="anchored" data-anchor-id="feature-selection">Feature Selection</h2>
<section id="seurat-2" class="level4">
<h4 class="anchored" data-anchor-id="seurat-2">Seurat</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DefaultAssay</span>(seurat_data)<span class="ot">&lt;-</span><span class="st">"RNA"</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>seurat_data <span class="ot">&lt;-</span> <span class="fu">FindVariableFeatures</span>(seurat_data, <span class="at">assay=</span><span class="st">"RNA"</span>,<span class="at">selection.method =</span> <span class="st">"vst"</span>, <span class="at">nfeatures =</span> <span class="dv">2000</span>, <span class="at">verbose=</span>F)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>top10 <span class="ot">&lt;-</span> <span class="fu">head</span>(<span class="fu">VariableFeatures</span>(seurat_data), <span class="dv">10</span>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> <span class="fu">VariableFeaturePlot</span>(seurat_data)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="fu">LabelPoints</span>(<span class="at">plot =</span> plot1, <span class="at">points =</span> top10, <span class="at">repel =</span> <span class="cn">TRUE</span>)<span class="sc">+</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>When using repel, set xnudge and ynudge to 0 for optimal results</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Transformation introduced infinite values in continuous x-axis</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 11053 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="bioconductor-2" class="level4">
<h4 class="anchored" data-anchor-id="bioconductor-2">Bioconductor</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>dec.pbmc <span class="ot">&lt;-</span> <span class="fu">modelGeneVar</span>(sce_data)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>chosen <span class="ot">&lt;-</span> <span class="fu">getTopHVGs</span>(dec.pbmc, <span class="at">n=</span><span class="dv">2000</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rowSubset</span>(sce_data) <span class="ot">&lt;-</span> chosen</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>fit.pbmc <span class="ot">&lt;-</span> <span class="fu">metadata</span>(dec.pbmc)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>plot2<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">mean=</span>fit.pbmc<span class="sc">$</span>mean,<span class="at">var=</span>fit.pbmc<span class="sc">$</span>var, <span class="at">color=</span><span class="fu">rownames</span>(sce_data)<span class="sc">%in%</span> chosen)<span class="sc">%&gt;%</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>mean,<span class="at">y=</span>var))<span class="sc">+</span><span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>color))<span class="sc">+</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"red"</span>))<span class="sc">+</span><span class="fu">geom_function</span>(<span class="at">color=</span><span class="st">"dodgerblue"</span>,<span class="at">fun =</span>fit.pbmc<span class="sc">$</span>trend ,<span class="at">size=</span><span class="fl">1.5</span>)<span class="sc">+</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="co">#+scale_x_continuous(trans='log2')+scale_y_continuous(trans='log2')</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>t<span class="ot">&lt;-</span><span class="fu">which</span>(<span class="fu">rownames</span>(sce_data)<span class="sc">%in%</span> chosen[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>td<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">mean=</span>fit.pbmc<span class="sc">$</span>mean[t],<span class="at">var=</span>fit.pbmc<span class="sc">$</span>var[t],<span class="at">symbol=</span><span class="fu">rowData</span>(sce_data)<span class="sc">$</span>Symbol[t])</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>plot2<span class="sc">+</span>ggrepel<span class="sc">::</span><span class="fu">geom_text_repel</span>(<span class="at">data=</span>td,<span class="fu">aes</span>(<span class="at">label=</span>symbol))<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">"Variance of log-expression"</span>)<span class="sc">+</span><span class="fu">xlab</span>(<span class="st">"Mean of log-expression"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="dimension-reduction" class="level2">
<h2 class="anchored" data-anchor-id="dimension-reduction">Dimension Reduction</h2>
<section id="pca" class="level3">
<h3 class="anchored" data-anchor-id="pca">PCA</h3>
<section id="seurat-3" class="level4">
<h4 class="anchored" data-anchor-id="seurat-3">Seurat</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>all.genes <span class="ot">&lt;-</span> <span class="fu">rownames</span>(seurat_data)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>seurat_data <span class="ot">&lt;-</span> <span class="fu">ScaleData</span>(seurat_data, <span class="at">features =</span> all.genes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Centering and scaling data matrix</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>seurat_data <span class="ot">&lt;-</span> <span class="fu">RunPCA</span>(seurat_data,</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>                      <span class="at">features =</span> <span class="fu">VariableFeatures</span>(<span class="at">object =</span> seurat_data),</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">verbose =</span> F,<span class="at">npcs =</span> <span class="dv">50</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">DimPlot</span>(seurat_data,<span class="at">reduction =</span>  <span class="st">"pca"</span>,)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ElbowPlot</span>(seurat_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>stdev_pca_seurat<span class="ot">&lt;-</span>seurat_data<span class="sc">@</span>reductions<span class="sc">$</span>pca<span class="sc">@</span>stdev </span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">findPC</span>(<span class="at">sdev =</span> stdev_pca_seurat,<span class="at">number =</span> <span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>),<span class="at">method =</span> <span class="st">'all'</span>,<span class="at">figure =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      Piecewise linear model First derivative Second derivative
30PCs                      3                6                 6
40PCs                      3               11                 6
50PCs                      4               11                11
      Preceding residual Perpendicular line K-means clustering
30PCs                  6                  6                  2
40PCs                  6                  6                  6
50PCs                 11                  7                  6</code></pre>
</div>
</div>
</section>
<section id="bioconductor-3" class="level4">
<h4 class="anchored" data-anchor-id="bioconductor-3">Bioconductor</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>sce_data <span class="ot">&lt;-</span> <span class="fu">runPCA</span>(sce_data,<span class="at">ncomponents =</span> <span class="dv">50</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotPCA</span>(sce_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>stdev_pca_sce <span class="ot">&lt;-</span> <span class="fu">attr</span>(<span class="fu">reducedDim</span>(sce_data, <span class="st">"PCA"</span>),</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"varExplained"</span>) <span class="sc">%&gt;%</span> <span class="fu">sqrt</span>()</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(stdev_pca_sce)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">findPC</span>(<span class="at">sdev =</span> stdev_pca_sce,<span class="at">number =</span> <span class="fu">c</span>(<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>),<span class="at">method =</span> <span class="st">'all'</span>,<span class="at">figure =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>      Piecewise linear model First derivative Second derivative
30PCs                      3                6                 4
40PCs                      3                9                 4
50PCs                      4               11                 9
      Preceding residual Perpendicular line K-means clustering
30PCs                  6                  6                  2
40PCs                  7                  6                  2
50PCs                 11                  7                  2</code></pre>
</div>
</div>
<p>I choose 11 PC.</p>
</section>
</section>
<section id="tsne" class="level3">
<h3 class="anchored" data-anchor-id="tsne">TSNE</h3>
<section id="seurat-4" class="level4">
<h4 class="anchored" data-anchor-id="seurat-4">Seurat</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>seurat_data <span class="ot">&lt;-</span> <span class="fu">RunTSNE</span>(seurat_data, <span class="at">dims =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>,<span class="at">reduction =</span> <span class="st">"pca"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">DimPlot</span>(seurat_data, <span class="at">reduction =</span> <span class="st">"tsne"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>sce_data <span class="ot">&lt;-</span> <span class="fu">runTSNE</span>(sce_data, <span class="at">dimred=</span><span class="st">"PCA"</span>,<span class="at">n_dimred=</span><span class="dv">11</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotReducedDim</span>(sce_data, <span class="at">dimred=</span><span class="st">"TSNE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>sce_data <span class="ot">&lt;-</span> <span class="fu">runTSNE</span>(sce_data, <span class="at">dimred=</span><span class="st">"PCA"</span>,<span class="at">n_dimred=</span><span class="dv">11</span>,<span class="at">perplexity=</span><span class="dv">5</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotReducedDim</span>(sce_data, <span class="at">dimred=</span><span class="st">"TSNE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>sce_data <span class="ot">&lt;-</span> <span class="fu">runTSNE</span>(sce_data, <span class="at">dimred=</span><span class="st">"PCA"</span>,<span class="at">n_dimred=</span><span class="dv">11</span>,<span class="at">perplexity=</span><span class="dv">20</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotReducedDim</span>(sce_data, <span class="at">dimred=</span><span class="st">"TSNE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>sce_data <span class="ot">&lt;-</span> <span class="fu">runTSNE</span>(sce_data, <span class="at">dimred=</span><span class="st">"PCA"</span>,<span class="at">n_dimred=</span><span class="dv">11</span>,<span class="at">perplexity=</span><span class="dv">80</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotReducedDim</span>(sce_data, <span class="at">dimred=</span><span class="st">"TSNE"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="umap" class="level3">
<h3 class="anchored" data-anchor-id="umap">UMAP</h3>
<section id="seurat-5" class="level4">
<h4 class="anchored" data-anchor-id="seurat-5">Seurat</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>seurat_data <span class="ot">&lt;-</span> <span class="fu">RunUMAP</span>(seurat_data, <span class="at">dims =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>,<span class="at">reduction =</span> <span class="st">"pca"</span>,<span class="at">verbose =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The default method for RunUMAP has changed from calling Python UMAP via reticulate to the R-native UWOT using the cosine metric
To use Python UMAP via reticulate, set umap.method to 'umap-learn' and metric to 'correlation'
This message will be shown once per session</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DimPlot</span>(seurat_data, <span class="at">reduction =</span> <span class="st">"umap"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>seurat_data <span class="ot">&lt;-</span> <span class="fu">RunUMAP</span>(seurat_data, <span class="at">dims =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>,<span class="at">reduction =</span> <span class="st">"pca"</span>,<span class="at">verbose =</span> F,<span class="at">n.neighbors =</span> <span class="dv">5</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">DimPlot</span>(seurat_data, <span class="at">reduction =</span> <span class="st">"umap"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>seurat_data <span class="ot">&lt;-</span> <span class="fu">RunUMAP</span>(seurat_data, <span class="at">dims =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>,<span class="at">reduction =</span> <span class="st">"pca"</span>,<span class="at">verbose =</span> F,<span class="at">n.neighbors =</span> <span class="dv">50</span>)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="fu">DimPlot</span>(seurat_data, <span class="at">reduction =</span> <span class="st">"umap"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>seurat_data <span class="ot">&lt;-</span> <span class="fu">RunUMAP</span>(seurat_data, <span class="at">dims =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>,<span class="at">reduction =</span> <span class="st">"pca"</span>,<span class="at">verbose =</span> F,<span class="at">n.neighbors =</span> <span class="dv">100</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">DimPlot</span>(seurat_data, <span class="at">reduction =</span> <span class="st">"umap"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">05122022</span>)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>sce_data <span class="ot">&lt;-</span> <span class="fu">runUMAP</span>(sce_data, <span class="at">dimred=</span><span class="st">"PCA"</span>,<span class="at">n_dimred=</span><span class="dv">11</span>)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plotReducedDim</span>(sce_data, <span class="at">dimred=</span><span class="st">"UMAP"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="clustering" class="level2">
<h2 class="anchored" data-anchor-id="clustering">Clustering</h2>
<section id="seurat-6" class="level4">
<h4 class="anchored" data-anchor-id="seurat-6">Seurat</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>seurat_data <span class="ot">&lt;-</span> <span class="fu">FindNeighbors</span>(seurat_data, <span class="at">dims =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Computing nearest neighbor graph</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Computing SNN</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>seurat_data <span class="ot">&lt;-</span> <span class="fu">FindClusters</span>(seurat_data, <span class="at">resolution =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck

Number of nodes: 11425
Number of edges: 385473

Running Louvain algorithm...
Maximum modularity in 10 random starts: 0.9107
Number of communities: 15
Elapsed time: 1 seconds</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DimPlot</span>(seurat_data, <span class="at">reduction =</span> <span class="st">"umap"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>seurat_data <span class="ot">&lt;-</span> <span class="fu">FindClusters</span>(seurat_data, <span class="at">resolution =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck

Number of nodes: 11425
Number of edges: 385473

Running Louvain algorithm...
Maximum modularity in 10 random starts: 0.8360
Number of communities: 22
Elapsed time: 1 seconds</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DimPlot</span>(seurat_data, <span class="at">reduction =</span> <span class="st">"umap"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>seurat_data <span class="ot">&lt;-</span> <span class="fu">FindClusters</span>(seurat_data, <span class="at">resolution =</span> <span class="fl">0.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Modularity Optimizer version 1.3.0 by Ludo Waltman and Nees Jan van Eck

Number of nodes: 11425
Number of edges: 385473

Running Louvain algorithm...
Maximum modularity in 10 random starts: 0.9677
Number of communities: 9
Elapsed time: 1 seconds</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DimPlot</span>(seurat_data, <span class="at">reduction =</span> <span class="st">"umap"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="bioconductor-4" class="level4">
<h4 class="anchored" data-anchor-id="bioconductor-4">Bioconductor</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">buildSNNGraph</span>(sce_data, <span class="at">k=</span><span class="dv">11</span>, <span class="at">use.dimred =</span> <span class="st">"PCA"</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>clust <span class="ot">&lt;-</span> igraph<span class="sc">::</span><span class="fu">cluster_walktrap</span>(g)<span class="sc">$</span>membership</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>sce_data<span class="sc">$</span>cluster_rank_walktrap <span class="ot">&lt;-</span> <span class="fu">factor</span>(clust)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plotReducedDim</span>(sce_data, <span class="st">"UMAP"</span>, <span class="at">colour_by=</span><span class="st">"cluster_rank_walktrap"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">reducedDim</span>(sce_data,<span class="st">"UMAP"</span>) <span class="sc">%&gt;%</span> <span class="fu">cbind</span>(<span class="fu">colData</span>(sce_data)) <span class="sc">%&gt;%</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>  as_tibble <span class="sc">%&gt;%</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>V1,<span class="at">y=</span>V2))<span class="sc">+</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>cluster_rank_walktrap), <span class="at">size=</span><span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>  cowplot<span class="sc">::</span><span class="fu">theme_cowplot</span>(<span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size=</span><span class="dv">2</span>)))<span class="sc">+</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"UMAP_2"</span>)<span class="sc">+</span><span class="fu">xlab</span>(<span class="st">"UMAP_1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Clustering like Seurat and playing with resolution</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>g <span class="ot">&lt;-</span> <span class="fu">buildSNNGraph</span>(sce_data, <span class="at">k=</span><span class="dv">11</span>, <span class="at">use.dimred =</span> <span class="st">"PCA"</span>,<span class="at">type =</span> <span class="st">"jaccard"</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>clust2 <span class="ot">&lt;-</span> igraph<span class="sc">::</span><span class="fu">cluster_louvain</span>(g, <span class="at">resolution =</span> <span class="fl">0.5</span>)<span class="sc">$</span>membership</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>sce_data<span class="sc">$</span>cluster_0<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">factor</span>(clust2)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plotReducedDim</span>(sce_data, <span class="st">"UMAP"</span>, <span class="at">colour_by=</span><span class="st">"cluster_0.5"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>clust2 <span class="ot">&lt;-</span> igraph<span class="sc">::</span><span class="fu">cluster_louvain</span>(g, <span class="at">resolution =</span> <span class="fl">0.1</span>)<span class="sc">$</span>membership</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>sce_data<span class="sc">$</span>cluster_0<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="fu">factor</span>(clust2)</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plotReducedDim</span>(sce_data, <span class="st">"UMAP"</span>, <span class="at">colour_by=</span><span class="st">"cluster_0.1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>clust2 <span class="ot">&lt;-</span> igraph<span class="sc">::</span><span class="fu">cluster_louvain</span>(g, <span class="at">resolution =</span> <span class="fl">1.5</span>)<span class="sc">$</span>membership</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>sce_data<span class="sc">$</span>cluster_1<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">factor</span>(clust2)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plotReducedDim</span>(sce_data, <span class="st">"UMAP"</span>, <span class="at">colour_by=</span><span class="st">"cluster_1.5"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="cluster-behavior" class="level5">
<h5 class="anchored" data-anchor-id="cluster-behavior">Cluster Behavior</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>colors<span class="ot">&lt;-</span>scater<span class="sc">:::</span><span class="fu">.get_palette</span>(<span class="st">"tableau10medium"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Silhouette width</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>sil.approx <span class="ot">&lt;-</span> bluster<span class="sc">::</span><span class="fu">approxSilhouette</span>(<span class="fu">reducedDim</span>(sce_data, <span class="st">"PCA"</span>), <span class="at">clusters=</span>sce_data<span class="sc">$</span>cluster_0<span class="fl">.5</span>)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>sil.data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(sil.approx)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>sil.data<span class="sc">$</span>closest <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(sil.data<span class="sc">$</span>width <span class="sc">&gt;</span> <span class="dv">0</span>, sce_data<span class="sc">$</span>cluster_0<span class="fl">.5</span>, sil.data<span class="sc">$</span>other))</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>sil.data<span class="sc">$</span>cluster <span class="ot">&lt;-</span> sce_data<span class="sc">$</span>cluster_0<span class="fl">.5</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sil.data, <span class="fu">aes</span>(<span class="at">x=</span>cluster, <span class="at">y=</span>width, <span class="at">colour=</span>closest)) <span class="sc">+</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    ggbeeswarm<span class="sc">::</span><span class="fu">geom_quasirandom</span>(<span class="at">method=</span><span class="st">"smiley"</span>)<span class="sc">+</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Cluster purity</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>pure.pbmc <span class="ot">&lt;-</span> bluster<span class="sc">::</span><span class="fu">neighborPurity</span>(<span class="fu">reducedDim</span>(sce_data, <span class="st">"PCA"</span>), sce_data<span class="sc">$</span>cluster_0<span class="fl">.5</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>pure.data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pure.pbmc)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>pure.data<span class="sc">$</span>maximum <span class="ot">&lt;-</span> <span class="fu">factor</span>(pure.data<span class="sc">$</span>maximum)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>pure.data<span class="sc">$</span>cluster <span class="ot">&lt;-</span> sce_data<span class="sc">$</span>cluster_0<span class="fl">.5</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pure.data, <span class="fu">aes</span>(<span class="at">x=</span>cluster, <span class="at">y=</span>purity, <span class="at">colour=</span>maximum)) <span class="sc">+</span></span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>    ggbeeswarm<span class="sc">::</span><span class="fu">geom_quasirandom</span>(<span class="at">method=</span><span class="st">"smiley"</span>)<span class="sc">+</span></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> colors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="comparing-clusters" class="level5">
<h5 class="anchored" data-anchor-id="comparing-clusters">Comparing Clusters</h5>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="st">"Walktrap"</span><span class="ot">=</span>sce_data<span class="sc">$</span>cluster_rank_walktrap, <span class="st">"Louvain"</span><span class="ot">=</span>sce_data<span class="sc">$</span>cluster_0<span class="fl">.5</span>)</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(tab) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Walktrap"</span>, <span class="fu">rownames</span>(tab))</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(tab) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Louvain"</span>, <span class="fu">colnames</span>(tab))</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>pheatmap<span class="sc">::</span><span class="fu">pheatmap</span>(<span class="fu">log10</span>(tab<span class="sc">+</span><span class="dv">10</span>), <span class="at">color=</span>viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="dv">100</span>), <span class="at">cluster_cols=</span><span class="cn">FALSE</span>, <span class="at">cluster_rows=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>jacc.mat <span class="ot">&lt;-</span> bluster<span class="sc">::</span><span class="fu">linkClustersMatrix</span>(sce_data<span class="sc">$</span>cluster_rank_walktrap, sce_data<span class="sc">$</span>cluster_0<span class="fl">.5</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(jacc.mat) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Walktrap"</span>, <span class="fu">rownames</span>(jacc.mat))</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(jacc.mat) <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"Louvain"</span>, <span class="fu">colnames</span>(jacc.mat))</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>pheatmap<span class="sc">::</span><span class="fu">pheatmap</span>(jacc.mat, <span class="at">color=</span>viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="dv">100</span>), <span class="at">cluster_cols=</span><span class="cn">FALSE</span>, <span class="at">cluster_rows=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>mat_clust<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="st">"res_0.1"</span><span class="ot">=</span>sce_data<span class="sc">$</span>cluster_0<span class="fl">.1</span>, <span class="st">"res_0.5"</span><span class="ot">=</span>sce_data<span class="sc">$</span>cluster_0<span class="fl">.5</span>,<span class="st">"res_1.5"</span><span class="ot">=</span>sce_data<span class="sc">$</span>cluster_1<span class="fl">.5</span>)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1111</span>)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="fu">clustree</span>(mat_clust, <span class="at">prefix=</span><span class="st">"res_"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="markers-seurat-object" class="level2">
<h2 class="anchored" data-anchor-id="markers-seurat-object">Markers (Seurat Object)</h2>
<section id="cluster-1-vs-cluster-2" class="level4">
<h4 class="anchored" data-anchor-id="cluster-1-vs-cluster-2">Cluster 1 vs Cluster 2</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Idents</span>(seurat_data)<span class="ot">&lt;-</span>seurat_data<span class="sc">$</span>RNA_snn_res.<span class="fl">0.5</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>seurat_data_filt<span class="ot">&lt;-</span>seurat_data[<span class="fu">rowSums</span>(seurat_data<span class="sc">@</span>assays<span class="sc">$</span>RNA<span class="sc">@</span>counts <span class="sc">&gt;</span><span class="dv">0</span> ) <span class="sc">&gt;</span> <span class="dv">50</span>,]</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>de_1_2<span class="ot">&lt;-</span><span class="fu">FindMarkers</span>(seurat_data_filt, <span class="at">ident.1 =</span><span class="dv">1</span>,<span class="at">ident.2=</span><span class="dv">2</span>,<span class="at">min.pct =</span> <span class="fl">0.25</span>, <span class="at">logfc.threshold =</span> <span class="fl">0.25</span>)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(de_1_2,<span class="fu">aes</span>(<span class="at">x=</span>avg_log2FC, <span class="at">y=</span><span class="sc">-</span><span class="fu">log10</span>(p_val_adj)))<span class="sc">+</span><span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>pct<span class="fl">.1</span>))<span class="sc">+</span></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">low=</span><span class="st">"black"</span>,<span class="at">high =</span> <span class="st">"magenta"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="find-all-markers-one-vs-the-rest" class="level4">
<h4 class="anchored" data-anchor-id="find-all-markers-one-vs-the-rest">Find All Markers one vs the rest</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>seurat.markers <span class="ot">&lt;-</span> <span class="fu">FindAllMarkers</span>(seurat_data_filt, <span class="at">only.pos =</span> <span class="cn">TRUE</span>,</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">min.pct =</span> <span class="fl">0.50</span>, <span class="at">logfc.threshold =</span> <span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating cluster 0</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating cluster 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating cluster 2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating cluster 3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating cluster 4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating cluster 5</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating cluster 6</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating cluster 7</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating cluster 8</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating cluster 9</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating cluster 10</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating cluster 11</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating cluster 12</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating cluster 13</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Calculating cluster 14</code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(seurat.markers)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        p_val avg_log2FC pct.1 pct.2 p_val_adj cluster    gene
CCR7        0   1.746634 0.823 0.156         0       0    CCR7
BCL11B      0   1.620198 0.926 0.292         0       0  BCL11B
TCF7        0   1.590896 0.869 0.230         0       0    TCF7
LEF1        0   1.549810 0.762 0.124         0       0    LEF1
PIK3IP1     0   1.479750 0.817 0.252         0       0 PIK3IP1
LDHB        0   1.474059 0.975 0.619         0       0    LDHB</code></pre>
</div>
</div>
</section>
<section id="comparing-clusters-by-pairs" class="level4">
<h4 class="anchored" data-anchor-id="comparing-clusters-by-pairs">Comparing clusters by pairs</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>marker.info <span class="ot">&lt;-</span> <span class="fu">scoreMarkers</span>(seurat_data_filt<span class="sc">@</span>assays<span class="sc">$</span>RNA<span class="sc">@</span>data, seurat_data_filt<span class="sc">$</span>RNA_snn_res.<span class="fl">0.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(marker.info)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(marker.info, dim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         0     1     2     3     4     5     6     7     8     9    10    11
[1,] 14485 14485 14485 14485 14485 14485 14485 14485 14485 14485 14485 14485
[2,]    19    19    19    19    19    19    19    19    19    19    19    19
        12    13    14
[1,] 14485 14485 14485
[2,]    19    19    19</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(marker.info<span class="sc">$</span><span class="st">'0'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>DataFrame with 6 rows and 19 columns
           self.average other.average self.detected other.detected
              &lt;numeric&gt;     &lt;numeric&gt;     &lt;numeric&gt;      &lt;numeric&gt;
AL627309.5   0.00996103    0.03546981    0.01088534      0.0539750
LINC01409    0.05994775    0.06675977    0.06277213      0.0960046
LINC01128    0.07511543    0.04580293    0.07656023      0.0671701
LINC00115    0.00826562    0.00918127    0.00798258      0.0136998
FAM41C       0.00990948    0.01287641    0.01052250      0.0197699
NOC2L        0.19921853    0.20061216    0.19375907      0.2662586
           mean.logFC.cohen min.logFC.cohen median.logFC.cohen max.logFC.cohen
                  &lt;numeric&gt;       &lt;numeric&gt;          &lt;numeric&gt;       &lt;numeric&gt;
AL627309.5     -0.150527969      -0.4867261        -0.14753206        0.101746
LINC01409      -0.023213597      -0.2064664         0.00948573        0.100287
LINC01128       0.135353397      -0.0608045         0.12135853        0.336278
LINC00115      -0.005953826      -0.0609704        -0.01779990        0.122247
FAM41C         -0.012910709      -0.3126970        -0.00374303        0.141978
NOC2L           0.000613232      -0.2793831         0.01173464        0.161922
           rank.logFC.cohen  mean.AUC   min.AUC median.AUC   max.AUC  rank.AUC
                  &lt;integer&gt; &lt;numeric&gt; &lt;numeric&gt;  &lt;numeric&gt; &lt;numeric&gt; &lt;integer&gt;
AL627309.5             1247  0.478639  0.433328   0.479584  0.504305      2225
LINC01409              3024  0.485058  0.440184   0.488638  0.503426      2153
LINC01128               596  0.506330  0.464176   0.512293  0.529046       766
LINC00115              2428  0.497177  0.490019   0.496989  0.503991      2242
FAM41C                 1631  0.495443  0.455740   0.498022  0.505261      1354
NOC2L                  1455  0.477961  0.380197   0.494532  0.510510      2231
           mean.logFC.detected min.logFC.detected median.logFC.detected
                     &lt;numeric&gt;          &lt;numeric&gt;             &lt;numeric&gt;
AL627309.5           -1.299155          -3.627340             -1.608572
LINC01409            -0.476843          -1.551686             -0.444566
LINC01128             0.379332          -0.973758              0.463179
LINC00115            -0.500435          -1.130641             -0.655775
FAM41C               -0.352989          -2.422225             -0.381313
NOC2L                -0.372021          -1.387882             -0.182204
           max.logFC.detected rank.logFC.detected
                    &lt;numeric&gt;           &lt;integer&gt;
AL627309.5           1.818183                 342
LINC01409            0.141970                3057
LINC01128            1.375129                 284
LINC00115            0.528197                1213
FAM41C               1.614667                 447
NOC2L                0.156357                3455</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(marker.info<span class="sc">$</span><span class="st">'0'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "self.average"          "other.average"         "self.detected"        
 [4] "other.detected"        "mean.logFC.cohen"      "min.logFC.cohen"      
 [7] "median.logFC.cohen"    "max.logFC.cohen"       "rank.logFC.cohen"     
[10] "mean.AUC"              "min.AUC"               "median.AUC"           
[13] "max.AUC"               "rank.AUC"              "mean.logFC.detected"  
[16] "min.logFC.detected"    "median.logFC.detected" "max.logFC.detected"   
[19] "rank.logFC.detected"  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>marker.info<span class="sc">$</span><span class="st">'3'</span> <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"Gene"</span>) <span class="sc">%&gt;%</span><span class="fu">arrange</span>(rank.AUC) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(rank.AUC<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Gene self.average other.average self.detected other.detected
1   CTSS     3.801811      2.080293             1      0.8156463
2 S100A9     5.753271      2.011809             1      0.6386556
3 S100A8     5.107025      1.521323             1      0.5392722
4 S100A6     3.719960      2.502475             1      0.9260105
5   MNDA     3.301313      1.206530             1      0.5152278
6    LYZ     5.058072      2.141061             1      0.6497189
  mean.logFC.cohen min.logFC.cohen median.logFC.cohen max.logFC.cohen
1         3.313892      -0.5512238           3.708353        7.052284
2         6.274254       1.3917778           5.539206       11.819090
3         6.276313       1.4020899           6.298098       11.098143
4         2.271957       0.5630242           2.176300        5.077679
5         5.581362       0.4718434           4.615489       11.213083
6         6.161543       0.5095405           5.733042       12.017791
  rank.logFC.cohen  mean.AUC   min.AUC median.AUC max.AUC rank.AUC
1                2 0.8566416 0.3484391  0.9856361       1        1
2                1 0.9693524 0.8408574  0.9987807       1        1
3                1 0.9662876 0.8410464  0.9985267       1        1
4                1 0.8879765 0.6536828  0.9401544       1        1
5                1 0.9377599 0.6316344  0.9969582       1        1
6                1 0.9356778 0.6371454  0.9997167       1        1
  mean.logFC.detected min.logFC.detected median.logFC.detected
1           0.3635300      -3.203427e-16            0.06061152
2           0.8283111       0.000000e+00            0.78329730
3           1.2528259       0.000000e+00            1.13805007
4           0.1295625      -3.203427e-16            0.01560176
5           1.8888663       0.000000e+00            1.28525938
6           0.8324444      -3.203427e-16            0.69699944
  max.logFC.detected rank.logFC.detected
1          1.3010340                1755
2          1.6769228                1253
3          2.5162117                 814
4          0.9828589                1755
5          4.6288414                 322
6          1.8354873                1326</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>g<span class="ot">&lt;-</span><span class="st">"MNDA"</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>seurat_data_filt<span class="sc">@</span>assays<span class="sc">$</span>RNA<span class="sc">@</span>data[g,] <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"Cell"</span>) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(<span class="fu">as_tibble</span>(seurat_data_filt[[]], <span class="at">rownames=</span><span class="st">"Cell"</span>), <span class="at">by=</span><span class="fu">c</span>(<span class="st">"Cell"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>RNA_snn_res.<span class="fl">0.5</span>, <span class="at">y=</span>value))<span class="sc">+</span><span class="fu">geom_violin</span>(<span class="at">scale =</span> <span class="st">"width"</span>, <span class="at">adjust=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>    ggbeeswarm<span class="sc">::</span><span class="fu">geom_quasirandom</span>(<span class="at">size=</span><span class="fl">0.1</span>, <span class="fu">aes</span>(<span class="at">color=</span>RNA_snn_res.<span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Rank means: is the smallest rank of each gene across all pairwise comparisons;If a gene has a small min-rank, we can conclude that it is one of the top upregulated genes in at least one comparison of cluster of interest to another cluster</p>
<p>On some occasions, ranking by the minimum can be highly effective as it yields a concise set of highly cluster-specific markers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>genes_c7<span class="ot">&lt;-</span>marker.info<span class="sc">$</span><span class="st">'7'</span> <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"Gene"</span>) <span class="sc">%&gt;%</span> <span class="fu">filter</span>(rank.logFC.cohen<span class="sc">&lt;=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> .<span class="sc">$</span>Gene</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotGroupedHeatmap</span>(Seurat<span class="sc">::</span><span class="fu">as.SingleCellExperiment</span>(seurat_data), <span class="at">features=</span>genes_c7, <span class="at">group=</span><span class="st">"RNA_snn_res.0.5"</span>, </span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">center=</span><span class="cn">TRUE</span>, <span class="at">zlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotDots</span>(Seurat<span class="sc">::</span><span class="fu">as.SingleCellExperiment</span>(seurat_data), genes_c7, <span class="at">group=</span><span class="st">"RNA_snn_res.0.5"</span>)<span class="sc">+</span><span class="fu">scale_color_gradient</span>(<span class="at">low =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"orange"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'colour' is already present. Adding another scale for 'colour',
which will replace the existing scale.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="visualizations" class="level2">
<h2 class="anchored" data-anchor-id="visualizations">Visualizations</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>markers.to.plot <span class="ot">&lt;-</span> seurat.markers <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> .<span class="sc">$</span>gene <span class="sc">%&gt;%</span> unique</span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="fu">DotPlot</span>(seurat_data, <span class="at">features =</span> markers.to.plot, <span class="at">cols=</span><span class="fu">c</span>(<span class="st">"white"</span>,<span class="st">"orange"</span>)) <span class="sc">+</span></span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">RotatedAxis</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>markers.to.plot <span class="ot">&lt;-</span> seurat.markers <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">5</span>) <span class="sc">%&gt;%</span> .<span class="sc">$</span>gene <span class="sc">%&gt;%</span> unique</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">DoHeatmap</span>(<span class="fu">subset</span>(seurat_data, <span class="at">downsample =</span> <span class="dv">100</span>), <span class="at">features =</span> markers.to.plot, <span class="at">size =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(seurat.markers<span class="sc">$</span>cluster)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0   1   2   3   4   5   6   7   8   9  10  11  12  13  14 
162 521  92 429 418 122 128 132 305 384  45 193 511  88 245 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>list_genes<span class="ot">&lt;-</span>seurat.markers <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">genes=</span><span class="fu">list</span>(gene)) <span class="sc">%&gt;%</span> .<span class="sc">$</span>genes</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(list_genes)<span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">"Cluster_"</span>, <span class="fu">unique</span>(seurat.markers<span class="sc">$</span>cluster))</span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-4"><a href="#cb138-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-5"><a href="#cb138-5" aria-hidden="true" tabindex="-1"></a><span class="fu">upset</span>(<span class="fu">fromList</span>(list_genes),<span class="at">nsets =</span> <span class="fu">length</span>(<span class="fu">names</span>(list_genes)),<span class="at">order.by =</span> <span class="st">"freq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>genes2plot<span class="ot">&lt;-</span>seurat.markers <span class="sc">%&gt;%</span> <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(avg_log2FC)) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> .<span class="sc">$</span>gene <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">VlnPlot</span>(seurat_data, <span class="at">features =</span> genes2plot, <span class="at">pt.size =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">RidgePlot</span>(seurat_data,<span class="at">features =</span> <span class="st">"LYZ"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Picking joint bandwidth of 0.18</code></pre>
</div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">FeaturePlot</span>(seurat_data,<span class="at">features =</span> <span class="fu">c</span>(<span class="st">"CD4"</span>, <span class="st">"CCR7"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">FeaturePlot</span>(seurat_data, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">"CD4"</span>, <span class="st">"CCR7"</span>), <span class="at">blend =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-79-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>Nebulosa<span class="sc">::</span><span class="fu">plot_density</span>(seurat_data, <span class="fu">c</span>(<span class="st">"CD4"</span>, <span class="st">"CCR7"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-80-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a>Nebulosa<span class="sc">::</span><span class="fu">plot_density</span>(seurat_data, <span class="fu">c</span>(<span class="st">"CD4"</span>, <span class="st">"CCR7"</span>), <span class="at">joint =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-81-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="magic" class="level4">
<h4 class="anchored" data-anchor-id="magic">Magic</h4>
<div class="callout-warning callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
IMPORTANT WARNING
</div>
</div>
<div class="callout-body-container callout-body">
<p>This might take a lot of memory</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># seurat_data_filt &lt;- magic(seurat_data_filt)</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="co"># seurat_data_filt &lt;- SeuratWrappers::RunALRA(seurat_data_filt)</span></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(seurat_data_filt,"seurat_withMagic_ALRA.RDS")</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>seurat_data_filt<span class="ot">&lt;-</span><span class="fu">readRDS</span>(<span class="st">"seurat_withMagic_ALRA.RDS"</span>)</span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-6"><a href="#cb146-6" aria-hidden="true" tabindex="-1"></a>(<span class="fu">VlnPlot</span>(seurat_data_filt, <span class="at">features=</span><span class="fu">c</span>(<span class="st">"CD4"</span>),<span class="at">assay=</span><span class="st">"RNA"</span>)<span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"LogNormalize"</span>))<span class="sc">+</span></span>
<span id="cb146-7"><a href="#cb146-7" aria-hidden="true" tabindex="-1"></a>(<span class="fu">VlnPlot</span>(seurat_data_filt, <span class="at">features=</span><span class="fu">c</span>(<span class="st">"CD4"</span>), <span class="at">assay=</span><span class="st">"MAGIC_RNA"</span>)<span class="sc">+</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"MAGIC"</span>))<span class="sc">+</span></span>
<span id="cb146-8"><a href="#cb146-8" aria-hidden="true" tabindex="-1"></a>(<span class="fu">VlnPlot</span>(seurat_data_filt, <span class="at">features=</span><span class="fu">c</span>(<span class="st">"CD4"</span>), <span class="at">assay=</span><span class="st">"alra"</span>)<span class="sc">+</span><span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">"ALRA"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-82-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>seurat_data_filt<span class="sc">@</span>active.assay <span class="ot">&lt;-</span> <span class="st">'MAGIC_RNA'</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>a<span class="ot">&lt;-</span><span class="fu">FeaturePlot</span>(seurat_data_filt, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">"CD4"</span>))<span class="sc">+</span> <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"C"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'colour' is already present. Adding another scale for 'colour',
which will replace the existing scale.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a>b<span class="ot">&lt;-</span><span class="fu">FeaturePlot</span>(seurat_data_filt, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">"CCR7"</span>))<span class="sc">+</span> <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"C"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'colour' is already present. Adding another scale for 'colour',
which will replace the existing scale.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>seurat_data_filt<span class="sc">@</span>active.assay <span class="ot">&lt;-</span> <span class="st">'alra'</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>a1<span class="ot">&lt;-</span><span class="fu">FeaturePlot</span>(seurat_data_filt, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">"CD4"</span>))<span class="sc">+</span> <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"C"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'colour' is already present. Adding another scale for 'colour',
which will replace the existing scale.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a>b1<span class="ot">&lt;-</span><span class="fu">FeaturePlot</span>(seurat_data_filt, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">"CCR7"</span>))<span class="sc">+</span> <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"C"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'colour' is already present. Adding another scale for 'colour',
which will replace the existing scale.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>seurat_data_filt<span class="sc">@</span>active.assay <span class="ot">&lt;-</span> <span class="st">'RNA'</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a>a2<span class="ot">&lt;-</span><span class="fu">FeaturePlot</span>(seurat_data_filt, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">"CD4"</span>))<span class="sc">+</span> <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"C"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'colour' is already present. Adding another scale for 'colour',
which will replace the existing scale.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a>b2<span class="ot">&lt;-</span><span class="fu">FeaturePlot</span>(seurat_data_filt, <span class="at">features =</span> <span class="fu">c</span>(<span class="st">"CCR7"</span>))<span class="sc">+</span> <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">"C"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Scale for 'colour' is already present. Adding another scale for 'colour',
which will replace the existing scale.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(a2,b2,a,b,a1,b1,<span class="at">ncol=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-83-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="cluster-annotation" class="level2">
<h2 class="anchored" data-anchor-id="cluster-annotation">Cluster Annotation</h2>
<section id="singler" class="level4">
<h4 class="anchored" data-anchor-id="singler">SingleR</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>ref <span class="ot">&lt;-</span> celldex<span class="sc">::</span><span class="fu">BlueprintEncodeData</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>snapshotDate(): 2022-04-26</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>see ?celldex and browseVignettes('celldex') for documentation</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>loading from cache</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>see ?celldex and browseVignettes('celldex') for documentation</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>loading from cache</code></pre>
</div>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sce_data)<span class="ot">&lt;-</span><span class="fu">rowData</span>(sce_data)<span class="sc">$</span>Symbol</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a>pred <span class="ot">&lt;-</span> SingleR<span class="sc">::</span><span class="fu">SingleR</span>(<span class="at">test=</span>sce_data, <span class="at">ref=</span>ref, <span class="at">labels=</span>ref<span class="sc">$</span>label.main)</span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plotScoreHeatmap</span>(pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-84-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Assigned=</span>pred<span class="sc">$</span>pruned.labels, <span class="at">Cluster=</span>sce_data<span class="sc">$</span>cluster_0<span class="fl">.5</span>)</span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>pheatmap<span class="sc">::</span><span class="fu">pheatmap</span>(<span class="fu">log2</span>(tab<span class="sc">+</span><span class="dv">1</span>), <span class="at">color=</span><span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"blue"</span>))(<span class="dv">101</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-85-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a>pred2 <span class="ot">&lt;-</span> <span class="fu">SingleR</span>(<span class="at">test=</span>sce_data, <span class="at">ref=</span>ref, <span class="at">labels=</span>ref<span class="sc">$</span>label.fine)</span>
<span id="cb168-2"><a href="#cb168-2" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Assigned=</span>pred2<span class="sc">$</span>pruned.labels, <span class="at">Cluster=</span>sce_data<span class="sc">$</span>cluster_0<span class="fl">.5</span>)</span>
<span id="cb168-3"><a href="#cb168-3" aria-hidden="true" tabindex="-1"></a>pheatmap<span class="sc">::</span><span class="fu">pheatmap</span>(<span class="fu">log2</span>(tab<span class="sc">+</span><span class="dv">1</span>), <span class="at">color=</span><span class="fu">colorRampPalette</span>(<span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"blue"</span>))(<span class="dv">101</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-86-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="cellid" class="level4">
<h4 class="anchored" data-anchor-id="cellid">CelliD</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a>seurat_data_filt <span class="ot">&lt;-</span>CelliD<span class="sc">::</span><span class="fu">RunMCA</span>(seurat_data_filt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Computing Fuzzy Matrix</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>5.885 sec elapsed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Computing SVD</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>203.832 sec elapsed</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Computing Coordinates</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>13.332 sec elapsed</code></pre>
</div>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>panglao <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(<span class="st">"https://panglaodb.se/markers/PanglaoDB_markers_27_Mar_2020.tsv.gz"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 8286 Columns: 14</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
chr (8): species, official gene symbol, cell type, nicknames, product descri...
dbl (6): ubiquitousness index, canonical marker, sensitivity_human, sensitiv...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>panglao_IS <span class="ot">&lt;-</span> panglao <span class="sc">%&gt;%</span> <span class="fu">filter</span>(organ <span class="sc">==</span> <span class="st">"Immune system"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">filter</span>(<span class="fu">grepl</span>(<span class="st">"Hs"</span>,species)) <span class="sc">%&gt;%</span></span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">group_by</span>(<span class="st">`</span><span class="at">cell type</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">summarise</span>(<span class="at">geneset =</span> <span class="fu">list</span>(<span class="st">`</span><span class="at">official gene symbol</span><span class="st">`</span>))</span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a>panglao_IS <span class="ot">&lt;-</span> <span class="fu">setNames</span>(panglao_IS<span class="sc">$</span>geneset, panglao_IS<span class="sc">$</span><span class="st">`</span><span class="at">cell type</span><span class="st">`</span>)</span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lapply</span>(panglao_IS[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>],head)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$`B cells`
[1] "CD2"   "CD5"   "MS4A1" "CR2"   "CD22"  "FCER2"

$`B cells memory`
[1] "CD38" "CD80" "CD84" "CD86" "NT5E" "PAX5"

$`B cells naive`
[1] "CD19"  "CD2"   "CD72"  "IL2RA" "MME"   "ABCB4"

$Basophils
[1] "CD69"   "IL3RA"  "CCR3"   "ENPP3"  "FCER1A" "TLR4"  

$`Dendritic cells`
[1] "IL6"  "CD86" "CD83" "CD1A" "CR2"  "TLR9"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a>HGT_gs <span class="ot">&lt;-</span> <span class="fu">RunCellHGT</span>(seurat_data_filt, <span class="at">pathways =</span> panglao_IS, <span class="at">dims =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>, <span class="at">n.features =</span> <span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
calculating distance</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>ranking genes</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>22 pathways kept for hypergeometric test out of 25, 3 filtered as less than 10 features was present in the data</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
calculating features overlap</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>performing hypergeometric test</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(HGT_gs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]    22 11425</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>HGT_gs[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>5 x 5 sparse Matrix of class "dgCMatrix"
                AAACCCAAGGCCCAAA-1 AAACCCAAGTAATACG-1 AAACCCAAGTCACACT-1
B cells                  .                   .                  .       
B cells memory           .                   .                  .       
B cells naive            .                   .                  .       
Basophils                0.0687406           1.179326           .       
Dendritic cells          0.8641467           2.590818           2.289788
                AAACCCACAAAGCGTG-1 AAACCCACAATCGAAA-1
B cells                          .          24.843038
B cells memory                   .          30.488829
B cells naive                    .          20.201899
Basophils                        .           .       
Dendritic cells                  .           2.732697</code></pre>
</div>
</div>
<p>This is a matrix of benjamini hochberg adjusted pvalue pvalue or a sparse matrix of (-log10) benjamini hochberg adjusted pvalue</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For each cell, assess the signature with the lowest corrected p-value (max -log10 corrected p-value)</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>gs_prediction <span class="ot">&lt;-</span> <span class="fu">rownames</span>(HGT_gs)[<span class="fu">apply</span>(HGT_gs, <span class="dv">2</span>, which.max)]</span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(gs_prediction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Macrophages"     "Monocytes"       "Dendritic cells" "T memory cells" 
[5] "B cells memory"  "B cells naive"  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For each cell, evaluate if the lowest p-value is significant</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>gs_prediction_signif <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">apply</span>(HGT_gs, <span class="dv">2</span>, max)<span class="sc">&gt;</span><span class="dv">2</span>, <span class="at">yes =</span> gs_prediction, <span class="st">"unassigned"</span>) <span class="co">#pvalue&lt;0.01</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Save cell type predictions as metadata within the Seurat object</span></span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>seurat_data_filt<span class="sc">$</span>CellID_prediction <span class="ot">&lt;-</span> gs_prediction_signif</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DimPlot</span>(seurat_data_filt,<span class="at">reduction =</span>  <span class="st">"umap"</span>,<span class="at">group.by =</span> <span class="st">"RNA_snn_res.0.5"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-93-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">DimPlot</span>(seurat_data_filt,<span class="at">reduction =</span>  <span class="st">"umap"</span>,<span class="at">group.by =</span> <span class="st">"CellID_prediction"</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-93-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Assigned=</span>seurat_data_filt<span class="sc">$</span>CellID_prediction, <span class="at">Cluster=</span>seurat_data_filt<span class="sc">$</span>RNA_snn_res.<span class="fl">0.5</span>)</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>tab <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Cluster, <span class="at">y=</span>Freq))<span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="st">"fill"</span>, <span class="fu">aes</span>(<span class="at">fill=</span>Assigned), <span class="at">stat=</span><span class="st">"identity"</span>)<span class="sc">+</span><span class="fu">scale_fill_manual</span>(<span class="at">values=</span><span class="fu">unname</span>(pals<span class="sc">::</span><span class="fu">alphabet2</span>(<span class="dv">22</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="sc_scripts_files/figure-html/unnamed-chunk-94-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="isee" class="level2">
<h2 class="anchored" data-anchor-id="isee">iSEE</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(sce_data)<span class="ot">&lt;-</span><span class="fu">rowData</span>(sce_data)<span class="sc">$</span>ID</span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="fu">iSEE</span>(sce_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>